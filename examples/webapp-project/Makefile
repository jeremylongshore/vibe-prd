DOCS=ai-dev/docs
SOP=ai-dev/sop
TPL=ai-dev/templates
T?=create-prd.md
N?=new-doc.md

.PHONY: status create list-templates help dev build

# AI-Dev Pipeline Commands
status:
	@echo "ğŸ“Š AI-Dev Pipeline Status: $(shell basename $(PWD))"
	@echo "========================================"
	@echo "ğŸ“š Templates: $(shell [ -d $(TPL) ] && echo "âœ… Available" || echo "âŒ Missing")"
	@echo "ğŸ“ Documents: $(shell [ -d $(DOCS) ] && ls -1 $(DOCS) 2>/dev/null | wc -l || echo "0") files"
	@echo ""
	@echo "ğŸ“‹ Current Documents:"
	@[ -d $(DOCS) ] && ls -1 $(DOCS) 2>/dev/null | sed 's/^/  âœ“ /' || echo "  (no documents yet)"
	@echo ""
	@echo "ğŸ¯ Example Project Status:"
	@echo "  âœ“ PRD (User Authentication)"
	@echo "  âœ“ ADR-001 (Core Architecture)"
	@echo "  â³ Tech Spec (In Progress)"
	@echo "  â³ Implementation Tasks"

create:
	@mkdir -p $(DOCS) $(SOP)
	@if [ ! -f "$(TPL)/$(T)" ]; then echo "âŒ Template not found: $(T)"; echo "ğŸ’¡ Use 'make list-templates' to see available templates"; exit 1; fi
	@if echo "$(N)" | grep -q "sop"; then
		cp "$(TPL)/$(T)" "$(SOP)/$(N)"
		echo "ğŸ“„ Created: $(SOP)/$(N)"
	else
		cp "$(TPL)/$(T)" "$(DOCS)/$(N)"
		echo "ğŸ“„ Created: $(DOCS)/$(N)"
	fi
	@echo "âœï¸  Next: Edit the document and update ai-dev/README.md checklist"

list-templates:
	@echo "ğŸ“š Available Templates:"
	@[ -d $(TPL) ] && ls -1 $(TPL)/*.md 2>/dev/null | sed 's|.*/||; s|\.md$$||' | sed 's/^/  - /' || echo "  (templates not found)"

help:
	@echo "ğŸš€ AI-Dev Pipeline Commands"
	@echo "============================"
	@echo "make status           - Show pipeline status"
	@echo "make create T=X N=Y   - Create document Y from template X"
	@echo "make list-templates   - Show available templates"
	@echo ""
	@echo "ğŸ“š Common Templates:"
	@echo "  create-prd.md       - Product Requirements Document"
	@echo "  adr-template.md     - Architecture Decision Record"
	@echo "  create-tech-spec.md - Technical Specification"
	@echo "  generate-tasks.md   - Implementation Tasks"
	@echo ""
	@echo "ğŸ”§ Project Commands"
	@echo "==================="
	@echo "make dev             - Start development server"
	@echo "make build           - Build for production"

# Project Development Commands
dev:
	@echo "ğŸš€ Starting TaskFlow development server..."
	@if [ -f "package.json" ]; then npm run dev; else echo "ğŸ“¦ Run 'npm install' first"; fi

build:
	@echo "ğŸ—ï¸  Building TaskFlow for production..."
	@if [ -f "package.json" ]; then npm run build; else echo "ğŸ“¦ Run 'npm install' first"; fi