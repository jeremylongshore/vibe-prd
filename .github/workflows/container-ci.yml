name: Container CI
on:
  push:
  pull_request:

defaults:
  run:
    working-directory: ./

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with: { node-version: '20' }
      - name: Generate docs (demo)
        run: |
          echo "Demo product now" > /tmp/demo-answers.txt
          echo "Users; pain1, pain2, pain3" >> /tmp/demo-answers.txt
          echo "Speed with quality" >> /tmp/demo-answers.txt
          echo "- Goal1" >> /tmp/demo-answers.txt
          echo "- Goal2" >> /tmp/demo-answers.txt
          echo "Budget 10k; 6 months; web+mobile" >> /tmp/demo-answers.txt
          echo "None" >> /tmp/demo-answers.txt
          echo "Risk1; Risk2; Risk3" >> /tmp/demo-answers.txt
          echo "Assumption1; Assumption2" >> /tmp/demo-answers.txt
          echo "MVP in 1 city" >> /tmp/demo-answers.txt
          node form-system/cli.js < /tmp/demo-answers.txt
          make prd
      - name: Debug tree
        run: |
          echo "::group::docs layout"
          find docs -maxdepth 2 -type f | sed 's#^#  - #'
          echo "::endgroup::"
          echo "::group::map.yaml"
          cat form-system/map.yaml
          echo "::endgroup::"
      - name: Verify suite
        run: make verify-outputs
      - name: Pack artifacts
        run: zip -qr artifacts.zip docs
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: docs-suite
          path: artifacts.zip